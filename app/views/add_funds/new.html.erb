<section id="add-funds-container" _="init set $page to 'add_funds_step_one' then set $deposit_type to ''" class="flex items-center justify-center w-screen min-h-screen sm:bg-gray-50 ">
  <div class="flex flex-col items-center justify-start w-full min-h-screen sm:w-2/3 sm:max-w-xl sm:justify-start ">
		<div class="flex items-center justify-between w-full px-6 sm:px-0 pb-8 pt-14 ">
			
			<button type="button" _="on click call go_back()">
				<svg class="cursor-pointer  sm" width="12" height="22" viewBox="0 0 12 22" fill="none" xmlns="http://www.w3.org/2000/svg">
					<path d="M9.26963 20.6933L0.686817 11.7355C0.477332 11.5187 0.373316 11.2377 0.373316 10.9578C0.373316 10.678 0.477332 10.3967 0.686817 10.1802L9.26963 1.22234C9.69863 0.772625 10.4106 0.758001 10.8587 1.18866C11.3099 1.61639 11.3245 2.33147 10.8924 2.77819L3.01738 11.0001L10.891 19.1375C11.3232 19.5828 11.3085 20.2991 10.8573 20.727C10.4092 21.1578 9.69619 21.1428 9.26963 20.6933Z" fill="#298D7B" />
				</svg>
			</button>

			<h1 class="text-2xl font-semibold text-gray-700">Add Funds</h1>
			
			<svg class="cursor-pointer" width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
				<path d="M6.228 7C6.777 5.835 8.258 5 10 5C12.21 5 14 6.343 14 8C14 9.4 12.722 10.575 10.994 10.907C10.452 11.011 10 11.447 10 12M10 15H10.01M19 10C19 11.1819 18.7672 12.3522 18.3149 13.4442C17.8626 14.5361 17.1997 15.5282 16.364 16.364C15.5282 17.1997 14.5361 17.8626 13.4442 18.3149C12.3522 18.7672 11.1819 19 10 19C8.8181 19 7.64778 18.7672 6.55585 18.3149C5.46392 17.8626 4.47177 17.1997 3.63604 16.364C2.80031 15.5282 2.13738 14.5361 1.68508 13.4442C1.23279 12.3522 1 11.1819 1 10C1 7.61305 1.94821 5.32387 3.63604 3.63604C5.32387 1.94821 7.61305 1 10 1C12.3869 1 14.6761 1.94821 16.364 3.63604C18.0518 5.32387 19 7.61305 19 10Z" stroke="#298D7B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
			</svg>
		</div>

		<form id="add-funds-form" class="farmbank-input-styling h-full flex flex-col flex-grow sm:flex-grow-0 w-full mb-10">
			<input type="hidden" name="authenticity_token" value="<%=form_authenticity_token %>" />
			
			<% if @errors.present?  %>
				<div class="flex flex-col justify-start w-full h-full px-8 space-y-10 sm:py-8 sm:shadow-sm sm:bg-white sm:h-auto sm:rounded-md">
					<div class="text-red-500 text-base font-semibold leading-normal">
						<%= @errors.join(", ") %>
					</div>
				</div>
			<% end %>
			
			<%= render partial: 'form_step_one'%>
			<%= render partial: 'online_transfer_step_two'%>
			<%= render partial: 'check_deposit_step_two'%>
			<%= render partial: 'check_deposit_step_three'%>
		</form>
	</div>
</section>

<script type="text/hyperscript">
	<%# TODO; Refactor this besed on deposit type selected during flow %>
	def changePage(current_step, new_step)
    add .hidden to current_step
    remove .hidden from new_step
  end
	
	def go_back()
		if $page == 'add_funds_step_one'
			go to url <%=app_home_path %>
		end

		if $page == 'online_transfer_step_two'
			set $page to 'add_funds_step_one'
			changePage(#online-transfer-step-two, #add-funds-step-one)
		end

		if $page == 'check_deposit_step_two'
			set $page to 'add_funds_step_one'
			changePage(#check-deposit-step-two, #add-funds-step-one)
		end

		if $page == 'check_deposit_step_three'
			set $page to 'check_deposit_step_two'
			changePage(#check-deposit-step-three, #check-deposit-step-two)
		end
	end

	def validateForm()
    set $form_valid to false
    
    if $page == 'add_funds_step_one'
      set $next_button to #add-funds-next-button
      
      if $amount_valid and $deposit_type_valid
        set $form_valid to true
      end
		end

		if $page == 'online_transfer_step_two'
			set $next_button to #confirm-online-transfer-button
			
			if $account_number_valid and $deposit_slip_valid
				set $form_valid to true
			end
    end

		if $page == 'check_deposit_step_two'
			set $next_button to #check-deposit-next-button
			 
			if $check_valid
				set $form_valid to true
			end 
		end

    if $form_valid
      call enableNextButton($next_button)
    else 
      call disableNextButton($next_button)
    end
  end 

  def enableNextButton(next_button)
    remove @disabled from next_button
    remove .bg-gray-300 .cursor-not-allowed from next_button
    add .bg-farmbank-yellow .hover:bg-yellow-500 to next_button
  end

  def disableNextButton(next_button) 
    add @disabled to next_button
    add .bg-gray-300 .cursor-not-allowed to next_button
    remove .bg-farmbank-yellow .hover:bg-yellow-500 from next_button
  end

</script>